<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">BerDPSK</span>,<span class="var type1" id="S3T1U4">ValsLev</span>,<span class="var type1" id="S4T1U5">AberLev</span>,<span class="var type1" id="S5T2U6">Esync</span>,<span class="var type1" id="S6T3U7">InterAB</span>,<span class="var type1" id="S7T1U8">LocMaxAB</span>,<span class="var type1" id="S8T1U9">MaxValAB</span>,<span class="var type1" id="S9T3U10">SeqFinAB</span>,<span class="var type1" id="S10T2U11">TxData</span>,<span class="var type1" id="S11T2U12">Data</span>] = RecDowDepsk(<span class="var type1" id="S12T1U15">MaxNumStag</span>,<span class="var type1" id="S13T1U16">IfftOrSum</span>,<span class="var type1" id="S14T1U17">T</span>,<span class="var type1" id="S15T1U18">Ta</span>,<span class="var type1" id="S16T4U19">Esync1</span>,<span class="var type1" id="S17T1U20">AddCP</span>,<span class="var type1" id="S18T1U21">StuffSampels</span>,<span class="var type1" id="S19T1U22">NumAmosCP</span>,<span class="var type1" id="S20T1U23">NPPB</span>,<span class="var type1" id="S21T1U24">NbDPSK</span>,<span class="var type1" id="S22T1U25">CurTesSiz</span>,<span class="var type1" id="S23T1U26">SyncPeriod</span>,<span class="var type1" id="S24T1U27">ThisCarr</span>,<span class="var type1" id="S25T4U28">TxDataMat</span>,<span class="var type1" id="S26T1U29">LevDefDpqsk</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%SyncAux   = Esync(IniSyncPos:SyncPos,:);%Selecting just the symbol to synchronize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%SyncedAux = SyncSymb(IniSyncPos:SyncPos,:);%Selecting just the symbol to synchronize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%%                   Plot for Qualitative analizes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%             PrintInfo(Ploting*15,t(IniSyncPos:SyncPos),Esync(IniSyncPos:<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%             SyncPos),SyncSymb(IniSyncPos:SyncPos),ESync1(IniSyncPos:<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%                                       SyncPos),ESync2(IniSyncPos:SyncPos));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%%                   Synchronizing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%This synchronization process is based on the mean expected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%value. That means, the information mean value should be within</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%one period of symbol. Thus, the mean value of the received</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%signal is acquired and compare of the known sync-word to</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%verify if this mean value is at the right possition. Which is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%the midel point (peak) of the highest level at the sync period</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%SyncAux(SyncAux&lt;0)              = 0;                           %To keep the mean value above zero anything under is neglected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%SyncAux(SyncAux&gt;=mean(SyncAux)) = 1;                           %Adding a flag to the first sample of the received mean value</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%SyncAux(SyncAux&lt;mean(SyncAux))  = -1;                          %All the others samples at set to the lowest level</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%PosToSyn  = find(ismember(SyncAux,1));                         %Finding where is the location of the samples to synchronize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%PosSynced = find(ismember(SyncedAux,1));                       %Finding where is the location of the samples to synchronize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%DiffPos = PosToSyn(round(end/2)) - PosSynced(round(end/2));    %Accounting the peak (midel point) displacement</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T1:U26"><span class="var type1" id="S27T1U32">sn</span>=<span class="mxinfo " id="T1:U28">(<span class="mxinfo " id="T1:U29">(<span class="mxinfo " id="T1:U30"><span class="mxinfo " id="T1:U31">1</span>/<span class="mxinfo " id="T1:U32">2</span></span>)*(<span class="mxinfo " id="T1:U33">(<span class="mxinfo " id="T1:U34">(<span class="mxinfo " id="T1:U35">1/2</span>)^<span class="var type1" id="S12T1U48">MaxNumStag</span></span>)-<span class="mxinfo " id="T1:U37">1</span></span>)</span>)/(<span class="mxinfo " id="T1:U38">(1/2)-1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo " id="T1:U39"><span class="var type1" id="S28T1U59">DiffPos</span> = <span class="mxinfo " id="T1:U41">round(<span class="mxinfo " id="T1:U42"><span class="mxinfo " id="T1:U43">(<span class="mxinfo " id="T1:U44"><span class="var type1" id="S27T1U66">sn</span>/(<span class="mxinfo " id="T1:U46"><span class="mxinfo " id="T1:U47">3</span>/<span class="mxinfo " id="T1:U48"><span class="mxinfo " id="T1:U49">2.55</span>^<span class="var type1" id="S13T1U72">IfftOrSum</span></span></span>)</span>)*<span class="var type1" id="S14T1U73">T</span></span>/<span class="var type1" id="S15T1U74">Ta</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T4:U53"><span class="var type1" id="S16T4U77">Esync1</span> = <span class="mxinfo " id="T4:U55">[<span class="mxinfo " id="T4:U56"><span class="var type1" id="S16T4U81">Esync1</span>(<span class="mxinfo " id="T2:U58"><span class="mxinfo " id="T1:U59"><span class="var type1" id="S28T1U84">DiffPos</span>+<span class="mxinfo " id="T1:U61">1</span></span>:end</span>,<span class="mxinfo " id="T5:U62">:</span>)</span>;<span class="mxinfo " id="T4:U63"><span class="var type1" id="S16T4U91">Esync1</span>(<span class="mxinfo " id="T2:U65"><span class="mxinfo " id="T1:U66">1</span>:<span class="var type1" id="S28T1U94">DiffPos</span></span>,<span class="mxinfo " id="T5:U68">:</span>)</span>]</span></span>;<span class="comment">%Shift based on sampling sliding</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%if DiffPos~=0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%if DiffPos&gt;0%If the difference is positive, left-shift<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%Esync = ifft(fft(Esync).*exp(1j*2*pi*f*(DiffPos*Ta))); %Shift based on time change</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%Esync = [Esync(DiffPos+1:end) Esync(1:DiffPos)];       %Shift based on sampling sliding</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%else%<span class="keyword">...</span><span class="comment"> but if the difference is negative, right-shift</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%Esync = ifft(fft(Esync).*exp(1j*2*pi*f*(DiffPos*Ta))); %Shift based on time change</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%Esync = [Esync(end+DiffPos+1:end) Esync(1:end + <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%DiffPos)];%Shift based on sampling sliding</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%Because of reasons, sometimes it may be required to make a</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%synchronization process with the  end of the data stream as</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%well. This following verification check if the user set (or</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%not) a second synchronization process to be done.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%%          Ploting the result for qualitative analizes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%             PrintInfo(Ploting*16,t(end-SyncPos+1:end-IniSyncPos+1),Esync<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%             (end-SyncPos+1:end-IniSyncPos+1),SyncSymb(end-SyncPos+1:end-<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%             IniSyncPos+1),ESync1(end-SyncPos+1:end-IniSyncPos+1),ESync2(<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%                                           end-SyncPos+1:end-IniSyncPos+1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%if SencondAdjust</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%%                   Synchronizing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%This synchronization process is based on the mean expected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%value. That means, the information mean value should be</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%within one period of symbol. Thus, the mean value of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%received signal is acquired and compare of the known</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%sync-word to verify if this mean value is at the right</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%possition.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%SyncAuxEnd   = Esync(end-SyncPos+1:end-IniSyncPos+1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%SyncedAuxEnd = SyncSymbEnd(end-SyncPos+1:end-IniSyncPos+1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%SyncAuxEnd(SyncAuxEnd&lt;0)                 = 0;              %To keep the mean value above zero anything under is neglected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%SyncAuxEnd(SyncAuxEnd&gt;=mean(SyncAuxEnd)) = 1;              %Adding a flag to the first sample of the received mean value</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%SyncAuxEnd(SyncAuxEnd&lt;mean(SyncAuxEnd))  = -1;             %All the others samples at set to the lowest level</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%PosToSynEnd  = find(ismember(SyncAuxEnd,1));               %Finding where is the location of the first sample to synchronize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">%PosSyncedEnd = find(ismember(SyncedAuxEnd,1));             %Finding where is the location of the first sample to synchronize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%DiffPosEnd = PosToSynEnd(round(end/2))-PosSyncedEnd(<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%round(end/2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%if DiffPosEnd~=0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%if DiffPosEnd&gt;0%If positive difference, left-shift<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%Esync = ifft(fft(Esync).*exp(1j*2*pi*f*(<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%DiffPosEnd*Ta)));%Shift based on time change</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%Esync = [Esync(DiffPosEnd+1:end) Esync(1:<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%DiffPosEnd)];%Shift based on sampling sliding</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%else%<span class="keyword">...</span><span class="comment"> but if the difference is negative, right-shift</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%Esync = ifft(fft(Esync).*exp(1j*2*pi*f*(<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%DiffPosEnd*Ta)));%Shift based on time change</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%Esync = [Esync(end-DiffPosEnd+1:end) Esync(<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%1:end-DiffPosEnd)];%Shift based on sampling sliding</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">%end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%if ThisCarr==126</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%EyeToPlot(CurrentTest,1:length(Esync(:))) = Esync(:);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%save(['savingforplotingeye' num2str(VetSnr)],'EyeToPlot','VetSnr','IfftOrSum','UsedModula','T','NPPB');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">%end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">%% Removing CP</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S17T1U98">AddCP</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">    <span class="mxinfo " id="T4:U70"><span class="var type1" id="S31T4U101">IxAux</span>  = <span class="mxinfo " id="T4:U72"><span class="var type1" id="S16T4U103">Esync1</span>(<span class="mxinfo " id="T2:U74"><span class="mxinfo " id="T1:U75">1</span>:<span class="mxinfo " id="T1:U76"><span class="mxinfo " id="T1:U77">end</span> - <span class="var type1" id="S18T1U109">StuffSampels</span></span></span>,<span class="mxinfo " id="T5:U79">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">    <span class="mxinfo " id="T4:U80"><span class="var type1" id="S31T4U113">IxAux</span>  = <span class="mxinfo " id="T4:U82">reshape(<span class="var type1" id="S31T4U116">IxAux</span>,(<span class="mxinfo " id="T1:U84"><span class="mxinfo " id="T1:U85"><span class="mxinfo " id="T1:U86">2</span>*<span class="var type1" id="S19T1U121">NumAmosCP</span></span>+<span class="var type1" id="S20T1U122">NPPB</span></span>),<span class="mxinfo " id="T1:U89"><span class="var type1" id="S21T1U124">NbDPSK</span>*<span class="var type1" id="S22T1U125">CurTesSiz</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">    <span class="mxinfo " id="T4:U92"><span class="var type1" id="S31T4U128">IxAux</span>  = <span class="mxinfo " id="T4:U94"><span class="var type1" id="S31T4U130">IxAux</span>(<span class="mxinfo " id="T2:U96"><span class="mxinfo " id="T1:U97"><span class="mxinfo " id="T1:U98">1</span>+<span class="var type1" id="S19T1U134">NumAmosCP</span></span>:<span class="mxinfo " id="T1:U100"><span class="mxinfo " id="T1:U101">end</span>-<span class="var type1" id="S19T1U138">NumAmosCP</span></span></span>,<span class="mxinfo " id="T5:U103">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">    <span class="mxinfo " id="T4:U104"><span class="var type1" id="S31T4U142">IxAux</span>  = <span class="mxinfo " id="T4:U106">reshape(<span class="var type1" id="S31T4U145">IxAux</span>,<span class="mxinfo " id="T1:U108"><span class="var type1" id="S20T1U147">NPPB</span>*<span class="var type1" id="S21T1U148">NbDPSK</span></span>,<span class="var type1" id="S22T1U149">CurTesSiz</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo " id="T4:U112"><span class="var type1" id="S16T4U152">Esync1</span>  = <span class="var type1" id="S31T4U153">IxAux</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">%% Taking the sampling the EVM meassurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%clear IxAux;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%PosAuxEout1 = NPPB/2:NPPB:length(Esync);                   %Varriable respossible to take just the samples at the middle of the symbol</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="comment">%PosAuxEout2 = ((NPPB/2)+(NPPB/16)):NPPB:length(Esync);      %Varriable respossible to take just the samples at the middle of the symbol</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="comment">%PosAuxEout3 = ((NPPB/2)-(NPPB/16)):NPPB:length(Esync);      %Varriable respossible to take just the samples at the middle of the symbol</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"><span class="comment">%IxAux1      = Esync(PosAuxEout1);                          %Normalizing the reference</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"><span class="comment">%IxAux2      = Esync(PosAuxEout2);    %Normalizing the reference</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="comment">%IxAux3      = Esync(PosAuxEout3);    %Normalizing the reference</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="comment">%a=a+0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="comment">%EvmMatRecA(1,:) = IxAux1;                       %Taking just the middle samples as references</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="comment">%EvmMatRecA(2,:) = IxAux2;                       %Taking just the middle samples as references</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="comment">%EvmMatRecA(3,:) = IxAux3;                       %Taking just the middle samples as references</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"><span class="comment">%EvmMatRecA(4,:) = IxAux1;                       %Taking just the middle samples as references</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="comment">%[EvmDBA(1), EvmPerA(1), EvmRmsA(1) ] = EvmCalc( EvmMatRef(ObsCarrPos==ThisCarr,:),IxAux1 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="comment">%[EvmDBA(2), EvmPerA(2), EvmRmsA(2) ] = EvmCalc( EvmMatRef(ObsCarrPos==ThisCarr,:),IxAux2 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"><span class="comment">%[EvmDBA(3), EvmPerA(3), EvmRmsA(3) ] = EvmCalc( EvmMatRef(ObsCarrPos==ThisCarr,:),IxAux3 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"><span class="comment">%[EvmDBA(4), EvmPerA(4), EvmRmsA(4) ] = EvmCalc( EvmMatRef(ObsCarrPos==ThisCarr,:),IxAux1 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"><span class="comment">%[EvmDBJA(1),EvmPerJA(1),EvmRmsJA(1)] = evm1(2,'dpsk',EvmMatRef(ObsCarrPos==ThisCarr,:),IxAux1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"><span class="comment">%[EvmDBJA(2),EvmPerJA(2),EvmRmsJA(2)] = evm1(2,'dpsk',EvmMatRef(ObsCarrPos==ThisCarr,:),IxAux2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"><span class="comment">%[EvmDBJA(3),EvmPerJA(3),EvmRmsJA(3)] = evm1(2,'dpsk',EvmMatRef(ObsCarrPos==ThisCarr,:),IxAux3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"><span class="comment">%[EvmDBJA(4),EvmPerJA(4),EvmRmsJA(4)] = evm1(2,'dpsk',EvmMatRef(ObsCarrPos==ThisCarr,:),IxAux1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"><span class="comment">%##########################################################################</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"><span class="mxinfo " id="T4:U115"><span class="var type1" id="S5T4U156">Esync</span> = <span class="mxinfo " id="T4:U117"><span class="var type1" id="S16T4U158">Esync1</span>(<span class="mxinfo " id="T2:U119"><span class="mxinfo " id="T1:U120"><span class="mxinfo " id="T1:U121">1</span>+<span class="mxinfo " id="T1:U122"><span class="var type1" id="S23T1U163">SyncPeriod</span>*<span class="var type1" id="S20T1U164">NPPB</span></span></span>:<span class="mxinfo " id="T1:U125"><span class="mxinfo " id="T1:U126">end</span>-<span class="mxinfo " id="T1:U127"><span class="var type1" id="S23T1U169">SyncPeriod</span>*<span class="var type1" id="S20T1U170">NPPB</span></span></span></span>,<span class="mxinfo " id="T5:U130">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"><span class="mxinfo " id="T2:U131"><span class="var type1" id="S5T2U174">Esync</span> = <span class="mxinfo " id="T2:U133">reshape(<span class="var type1" id="S5T4U177">Esync</span>,1,<span class="mxinfo " id="T1:U135"><span class="mxinfo " id="T1:U136">size(<span class="var type1" id="S5T4U182">Esync</span>,1)</span>*<span class="mxinfo " id="T1:U138">size(<span class="var type1" id="S5T4U186">Esync</span>,2)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line"><span class="mxinfo " id="T2:U140"><span class="var type1" id="S34T2U190">PosIx</span> = <span class="mxinfo " id="T2:U142"><span class="mxinfo " id="T1:U143"><span class="var type1" id="S20T1U194">NPPB</span>/<span class="mxinfo " id="T1:U145">2</span></span>:<span class="var type1" id="S20T1U196">NPPB</span>:<span class="mxinfo " id="T1:U147">size(<span class="var type1" id="S5T2U199">Esync</span>,2)</span></span></span>;<span class="comment">%Possition of the central samples - but the number of samples per symbol is even ????</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"><span class="comment">%IxAux = Esync(PosIx,:);%From the main received signal just a few samples are taken for further evaluation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"><span class="mxinfo " id="T1:U149"><span class="var type1" id="S35T1U203">n</span>     = <span class="mxinfo " id="T1:U151">100</span></span>;<span class="comment">%The number of boxes to be filled up on the histogram process</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"><span class="mxinfo " id="T1:U152"><span class="var type1" id="S36T1U207">Perce</span> = <span class="mxinfo " id="T1:U154">0.7</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="comment">%At this process each eye will be evaluated separetelly. It is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line"><span class="comment">%important to remember that the PAM4 has 4 levels, which means</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line"><span class="comment">%three level of decissions that are exaclty the center of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line"><span class="comment">%eye diagram.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line"><span class="comment">%BerDPSKAux = zeros(1,size(Esync,2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line"><span class="comment">%AberLevAux = zeros(1,size(Esync,2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line"><span class="comment">%ValsLevAux = zeros(1,size(Esync,2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line"><span class="comment">%for jj=1:size(Esync,2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line"><span class="mxinfo " id="T2:U155"><span class="var type1" id="S37T2U211">IxAuxAB</span> = <span class="mxinfo " id="T2:U157"><span class="var type1" id="S5T2U213">Esync</span>(<span class="var type1" id="S34T2U214">PosIx</span>)</span></span>;<span class="comment">%Taking just those values relative to the uper eye</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line"><span class="mxinfo " id="T3:U160"><span class="var type1" id="S6T3U217">InterAB</span> = <span class="mxinfo " id="T3:U162">linspace(<span class="mxinfo " id="T1:U163"><span class="var type1" id="S36T1U221">Perce</span>*(<span class="mxinfo " id="T1:U165">min(<span class="var type1" id="S5T2U225">Esync</span>)</span>)</span>,<span class="mxinfo " id="T1:U167"><span class="var type1" id="S36T1U227">Perce</span>*(<span class="mxinfo " id="T1:U169">max(<span class="var type1" id="S5T2U231">Esync</span>)</span>)</span>,<span class="var type1" id="S35T1U232">n</span>)</span></span>;                     <span class="comment">%Building the histogram boxes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line"><span class="mxinfo " id="T3:U172"><span class="var type1" id="S41T3U235">EyeAB</span> = <span class="mxinfo " id="T3:U174">hist(<span class="var type1" id="S37T2U238">IxAuxAB</span>,<span class="var type1" id="S6T3U239">InterAB</span>)</span></span>;                                 <span class="comment">%filling up the boxes with samples that fit on them.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line"><span class="comment">%What we are looking for here are not where exist the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line"><span class="comment">%occurrences of values. The eye is where there is not samples,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line"><span class="comment">%this means, the decission level is a reagion between actual</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line"><span class="comment">%levels thus this reagion does not contain any signal.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line"><span class="mxinfo " id="T6:U177"><span class="var type1" id="S41T6U242">EyeAB</span> = <span class="mxinfo " id="T6:U179">~<span class="var type1" id="S41T3U244">EyeAB</span></span></span>;                                                <span class="comment">%Changing zeros to one - Zeros compose the eye region</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line"><span class="comment">%Starting variables that will be used to identify the eye</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line"><span class="comment">%diagram.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line"><span class="mxinfo " id="T1:U181"><span class="var type1" id="S43T1U247">CountAB</span>   = <span class="mxinfo " id="T1:U183">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line"><span class="mxinfo " id="T3:U184"><span class="var type1" id="S44T3U251">SeqOnesAB</span> = <span class="mxinfo " id="T3:U186">zeros(<span class="mxinfo " id="T1:U187">1</span>,<span class="mxinfo " id="T1:U188">length(<span class="var type1" id="S41T6U257">EyeAB</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line"><span class="mxinfo " id="T3:U190"><span class="var type1" id="S9T3U260">SeqFinAB</span>  = <span class="mxinfo " id="T3:U192">zeros(<span class="mxinfo " id="T1:U193">1</span>,<span class="mxinfo " id="T1:U194">length(<span class="var type1" id="S41T6U266">EyeAB</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line"><span class="mxinfo " id="T1:U196"><span class="var type1" id="S47T1U269">SeqIniAB</span>  = <span class="mxinfo " id="T1:U198">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line"><span class="comment">%The for loop will take account of every box with ones. It is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line"><span class="comment">%important to take note that the not operator was used in this</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line"><span class="comment">%vector, therefore ones means zeros (the eye diagram -</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line"><span class="comment">%possibly) and zeros means values abouve zeroa (not the eye).</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S48T1U273">kk</span>=<span class="mxinfo " id="T1:U200">1</span>:length(<span class="var type1" id="S41T6U278">EyeAB</span>)                                         <span class="comment">%For every box</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T7:U202"><span class="var type1" id="S41T6U282">EyeAB</span>(<span class="var type1" id="S48T1U283">kk</span>)</span>                                               <span class="comment">%if it contains "1"</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">        <span class="mxinfo " id="T1:U205"><span class="mxinfo " id="T1:U206"><span class="var type1" id="S44T3U287">SeqOnesAB</span>(<span class="var type1" id="S47T1U288">SeqIniAB</span>)</span>=<span class="var type1" id="S43T1U289">CountAB</span></span>;                           <span class="comment">%count this element as part of a consecutive sequency</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">        <span class="mxinfo " id="T1:U210"><span class="var type1" id="S43T1U292">CountAB</span> = <span class="mxinfo " id="T1:U212"><span class="var type1" id="S43T1U294">CountAB</span> + <span class="mxinfo " id="T1:U214">1</span></span></span>;                                 <span class="comment">%adds one to the counter of consecutive elements "1"</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T7:U215"><span class="var type1" id="S48T1U299">kk</span>==<span class="mxinfo " id="T1:U217">length(<span class="var type1" id="S41T6U302">EyeAB</span>)</span></span>                                   <span class="comment">%if the current box is the last box we got to an end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">            <span class="mxinfo " id="T1:U219"><span class="mxinfo " id="T1:U220"><span class="var type1" id="S9T3U306">SeqFinAB</span>(<span class="var type1" id="S47T1U307">SeqIniAB</span>)</span> = <span class="var type1" id="S48T1U308">kk</span></span>;                           <span class="comment">%The final sequency element is equal to its possition (kk)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">    <span class="keyword">else</span>                                                       <span class="comment">%else if the current box contains "0"</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">        <span class="mxinfo " id="T1:U224"><span class="mxinfo " id="T1:U225"><span class="var type1" id="S9T3U313">SeqFinAB</span>(<span class="var type1" id="S47T1U314">SeqIniAB</span>)</span> = <span class="mxinfo " id="T1:U228"><span class="var type1" id="S48T1U316">kk</span>-<span class="mxinfo " id="T1:U230">1</span></span></span>;                             <span class="comment">%the previous element was the last element of a consecutive sequency of ones</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">        <span class="mxinfo " id="T1:U231"><span class="var type1" id="S47T1U320">SeqIniAB</span> = <span class="mxinfo " id="T1:U233"><span class="var type1" id="S47T1U322">SeqIniAB</span> + <span class="mxinfo " id="T1:U235">1</span></span></span>;                               <span class="comment">%adds one to the counter of consecutive number (take in account how many sequencies there are)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">        <span class="mxinfo " id="T1:U236"><span class="var type1" id="S43T1U326">CountAB</span> = <span class="mxinfo " id="T1:U238">1</span></span>;                                           <span class="comment">%reset the counter of consecutive elements to mark the start of a new consecutive sequence</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line"><span class="comment">%If the eye is open, which means there is a clear difference</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line"><span class="comment">%between adjacent levels, the eye diagram will be the longest</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"><span class="comment">%sequence of ones.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">[<span class="var type1" id="S8T1U331">MaxValAB</span>,<span class="var type1" id="S7T1U332">LocMaxAB</span>]=max(<span class="var type1" id="S44T3U335">SeqOnesAB</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line"><span class="mxinfo " id="T7:U242"><span class="keyword">if</span> <span class="mxinfo " id="T7:U243"><span class="mxinfo " id="T7:U244"><span class="var type1" id="S7T1U340">LocMaxAB</span>&lt;<span class="mxinfo " id="T1:U246">2</span></span> || <span class="mxinfo " id="T7:U247"><span class="var type1" id="S8T1U343">MaxValAB</span>&lt;<span class="mxinfo " id="T1:U249">2</span></span></span>                                    <span class="comment">%if any sequency was found or there is just one sequency it is a error thus</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">    <span class="mxinfo " id="T1:U250"><span class="var type1" id="S49T1U347">LevDec3</span> = <span class="mxinfo " id="T1:U252">0.0</span></span>;                                            <span class="comment">%the decission level will be by default 0.67. Also, the other variables will</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">    <span class="mxinfo " id="T1:U253"><span class="var type1" id="S7T1U351">LocMaxAB</span> = <span class="mxinfo " id="T1:U255">1</span></span>;                                              <span class="comment">%will be set with values to not cause errors in the future</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">    <span class="mxinfo " id="T1:U256"><span class="mxinfo " id="T1:U257"><span class="var type1" id="S9T3U356">SeqFinAB</span>(<span class="mxinfo " id="T1:U259">1</span>)</span>=<span class="mxinfo " id="T1:U260">2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">    <span class="mxinfo " id="T1:U261"><span class="var type1" id="S8T1U361">MaxValAB</span> = <span class="mxinfo " id="T1:U263">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">    <span class="mxinfo " id="T1:U264"><span class="mxinfo " id="T1:U265"><span class="var type1" id="S6T3U366">InterAB</span>(<span class="mxinfo " id="T1:U267">1</span>)</span>=<span class="var type1" id="S49T1U368">LevDec3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line"><span class="keyword">else</span>                                                           <span class="comment">%if a sequency was found the middle of the eye will be the middle of the sequency</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T7:U269">(<span class="mxinfo " id="T1:U270"><span class="mxinfo " id="T1:U271"><span class="var type1" id="S9T3U376">SeqFinAB</span>(<span class="var type1" id="S7T1U377">LocMaxAB</span>)</span>-<span class="mxinfo " id="T1:U274"><span class="var type1" id="S8T1U379">MaxValAB</span>/<span class="mxinfo " id="T1:U276">2</span></span></span>)&lt;<span class="mxinfo " id="T1:U277">1</span></span>                       <span class="comment">%if for some reason the final element of the sequency minus the half of its</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line">        <span class="mxinfo " id="T1:U278"><span class="var type1" id="S49T1U384">LevDec3</span> = <span class="mxinfo " id="T1:U280">0.0</span></span>;                                         <span class="comment">%length results in a negative value, something went very wrong, and by</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line">    <span class="keyword">else</span>                                                       <span class="comment">%default it will be set to 0.7</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line">        <span class="mxinfo " id="T1:U281"><span class="var type1" id="S49T1U389">LevDec3</span> = <span class="mxinfo " id="T1:U283"><span class="var type1" id="S6T3U391">InterAB</span>(<span class="mxinfo " id="T1:U285">round(<span class="mxinfo " id="T1:U286"><span class="mxinfo " id="T1:U287"><span class="var type1" id="S9T3U396">SeqFinAB</span>(<span class="var type1" id="S7T1U397">LocMaxAB</span>)</span>-<span class="mxinfo " id="T1:U290"><span class="var type1" id="S8T1U399">MaxValAB</span>/<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line">            <span class="mxinfo " id="T1:U292">2</span></span></span>)</span>)</span></span>;<span class="comment">%Otherwise, the decission level is the middle of the sequency</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="comment">%another way to measure the eye opening is the get all the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"><span class="comment">%boxes and find all peaks on it, that will be a plato created</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"><span class="comment">%by the sequences of ones (which was zeros). From thos peaks,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line"><span class="comment">%the eye diagram will be the longer of them hence it will take</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="comment">%the most part of the vector that store the findpeaks result.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line"><span class="comment">%Thus, the middle of the eye will be basically the middle of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line"><span class="comment">%the peaks vector.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"><span class="mxinfo " id="T8:U293"><span class="var type1" id="S50T8U403">LocAB</span> = <span class="mxinfo " id="T8:U295">find(<span class="var type1" id="S41T6U406">EyeAB</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U297">~<span class="mxinfo " id="T7:U298">any(<span class="var type1" id="S50T8U412">LocAB</span>)</span></span>                                              <span class="comment">%if for some reason there are no peaks, something went wrong.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">    <span class="comment">%LocAB = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">    <span class="mxinfo " id="T1:U300"><span class="var type1" id="S53T1U415">LevelDec3</span> = <span class="mxinfo " id="T1:U302">0.0</span></span>;<span class="comment">%mean(Levels(3:4));                       %by default the decission level will be set to 0.65</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">    <span class="mxinfo " id="T1:U303"><span class="var type1" id="S53T1U420">LevelDec3</span> = <span class="var type1" id="S49T1U421">LevDec3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line"><span class="comment">%##########################################################################</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line"><span class="comment">%[~,~,EyeOpenQ,EyeOpenHighQ,EyeOpenLowQ] = Olho(EoutQ,T,NPPB,0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line"><span class="mxinfo " id="T1:U306"><span class="var type1" id="S4T1U424">AberLev</span> = <span class="mxinfo " id="T1:U308"><span class="mxinfo " id="T1:U309"><span class="var type1" id="S6T3U427">InterAB</span>(<span class="mxinfo " id="T1:U311"><span class="var type1" id="S9T3U429">SeqFinAB</span>(<span class="var type1" id="S7T1U430">LocMaxAB</span>)</span>)</span>-<span class="mxinfo " id="T1:U314"><span class="var type1" id="S6T3U432">InterAB</span>(<span class="mxinfo " id="T1:U316">round(<span class="mxinfo " id="T1:U317"><span class="mxinfo " id="T1:U318"><span class="var type1" id="S9T3U437">SeqFinAB</span>(<span class="var type1" id="S7T1U438">LocMaxAB</span>)</span>-<span class="var type1" id="S8T1U439">MaxValAB</span></span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line"><span class="mxinfo " id="T1:U322"><span class="var type1" id="S3T1U442">ValsLev</span> = <span class="var type1" id="S49T1U443">LevDec3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line"><span class="comment">%%               Recovering the Information</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line"><span class="comment">%Once the Income signal was synchronized it is possible to</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line"><span class="comment">%recover the signal.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line"><span class="comment">%After passing the optical signal to the eletrical domain, for</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line"><span class="comment">%actually detect the data withing the signal the following</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line"><span class="comment">%steps are needed.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line"><span class="comment">%Finding Decission Levels:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line"><span class="comment">%The process for decoding the income signal will be based on</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line"><span class="comment">%eletronic comparators. Inasmuch as the right decission level</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line"><span class="comment">%must be acquired for accurately decide, within a symbol</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line"><span class="comment">%periode, what that current leavel means (ones or zeros).</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line"><span class="comment">%The process hereafter of chosing the  decission levels is not</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line"><span class="comment">%deterministic rather it is a statistic process. The main idea</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line"><span class="comment">%is to take the decission level from the histogram generated</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line"><span class="comment">%from the income signal stream.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line"><span class="comment">%This process is realized inside the function Olho.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line"><span class="comment">%Basicaly the decission level will be the minimal value of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line"><span class="comment">%currente eye under evaluation plus the half of the its eye</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line"><span class="comment">%opening.The following ilustration better describe this process</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line"><span class="comment">%Eye Limits:   + (1/2 * Eye Opening:)  =    Comparisson Limit:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line"><span class="comment">%UperLevel  ______     ______________     _____</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line"><span class="comment">%                 \   /      |       \   /</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line"><span class="comment">%                  \ /       |        \ /</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line"><span class="comment">%                   \ Half Eye Opening /     Decission Level</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line"><span class="comment">%                  / \       |        / \</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line"><span class="comment">%LowerLevel ______/   \______|_______/   \_____</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line"><span class="comment">%Once the signal was processed the next step is through a</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line"><span class="comment">%comparator decide the actual information received.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line"><span class="comment">%For accurately read the income signal is necessary more than</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line"><span class="comment">%just have the decision level, it is also needed to know where</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line"><span class="comment">%it occurs. For instance, if we decide to use just to take the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line"><span class="comment">%decision level and measure the mean value across and a portion</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line"><span class="comment">%of the time period, which portion should we take? It would be</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line"><span class="comment">%logical to take the central portion, but the bit may be</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line"><span class="comment">%deformed in such way that the information gets concentrated</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line"><span class="comment">%out of the middle part, which means the symbol is not</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line"><span class="comment">%symmetric. The symmetry information can be acquired from the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line"><span class="comment">%eye diagram by measuring the longitudinal opening. The</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line"><span class="comment">%following sketch better describes this process:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line"><span class="comment">%                   Point of Symmetry</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line"><span class="comment">%         _____     _______|_______     _____</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line"><span class="comment">%              \   /               \   /</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line"><span class="comment">%               \ /  Longitudinal   \ /</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line"><span class="comment">%                \ ----------------- /</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line"><span class="comment">%               / \    Opening      / \</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line"><span class="comment">%         _____/   \_______________/   \_____</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line"><span class="comment">%With those two pieces of information, decision level and point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line"><span class="comment">%of symmetry, we have the X, Y coordinates for the centre of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line"><span class="comment">%the Eye Diagram. Therefore, as long as there is an opening on</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,264" id="srcline264">264</a></span><span class="line"><span class="comment">%it it will be possible to recover the transmitted information</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,265" id="srcline265">265</a></span><span class="line"><span class="comment">%without error<span class="keyword">...</span><span class="comment"> theoretically.</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,266" id="srcline266">266</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,267" id="srcline267">267</a></span><span class="line"><span class="comment">%As this process is also statistical, first we reshape the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,268" id="srcline268">268</a></span><span class="line"><span class="comment">%income vector to analyze all periods at the same time.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,269" id="srcline269">269</a></span><span class="line"><span class="comment">%                 EyeSymMat = reshape(Esync(1+SyncPeriod*NPPB:end-SyncPeriod*<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,270" id="srcline270">270</a></span><span class="line"><span class="comment">%                     NPPB),NPPB,NbDPSK-2*SyncPeriod);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,271" id="srcline271">271</a></span><span class="line"><span class="comment">%Then we take the values that compose the decision level</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,272" id="srcline272">272</a></span><span class="line"><span class="comment">%because they will mark the point of symmetry.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,273" id="srcline273">273</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,274" id="srcline274">274</a></span><span class="line"><span class="comment">%Firstly it was set the interval in which the histogram will be</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,275" id="srcline275">275</a></span><span class="line"><span class="comment">%build. It is based on the number of samples per bit period.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,276" id="srcline276">276</a></span><span class="line"><span class="comment">%                 Interval = linspace(min(Esync(1+SyncPeriod*NPPB:end-<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,277" id="srcline277">277</a></span><span class="line"><span class="comment">%                     SyncPeriod*NPPB)),max(Esync(1+SyncPeriod*NPPB:end-SyncPeriod<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,278" id="srcline278">278</a></span><span class="line"><span class="comment">%                     *NPPB)),2*NPPB);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,279" id="srcline279">279</a></span><span class="line"><span class="comment">%Therefore, the MATLAB hist function returns the number of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,280" id="srcline280">280</a></span><span class="line"><span class="comment">%occurrence of each interval.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,281" id="srcline281">281</a></span><span class="line"><span class="comment">%                 EyeMax = hist(Esync,Interval);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,282" id="srcline282">282</a></span><span class="line"><span class="comment">%                 EyeMaxaux = [0 EyeMax 0];                                      %Zeros are added at the EyeMax to auxiliate the finding peaks process</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,283" id="srcline283">283</a></span><span class="line"><span class="comment">%                 [~,EyeLoc] = findpeaks(EyeMaxaux,'MinPeakDistance',NPPB/4,<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,284" id="srcline284">284</a></span><span class="line"><span class="comment">%                     'SortStr','descend','NPeaks',2);%The peaks on the Eye profile will be the levels at the Eyes limit</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,285" id="srcline285">285</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,286" id="srcline286">286</a></span><span class="line"><span class="comment">%From the location of the max values that occured, which means</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,287" id="srcline287">287</a></span><span class="line"><span class="comment">%the uper and lower level of the eye diagram it needs to take</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,288" id="srcline288">288</a></span><span class="line"><span class="comment">%the actual value that those occurences represent that is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,289" id="srcline289">289</a></span><span class="line"><span class="comment">%withing the the Interval variable.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,290" id="srcline290">290</a></span><span class="line"><span class="comment">%                 ValToSeek = Interval(EyeLoc-1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,291" id="srcline291">291</a></span><span class="line"><span class="comment">%The number of ocurrences is a statical measure therefore one</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,292" id="srcline292">292</a></span><span class="line"><span class="comment">%does not have control which interval will have the highest</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,293" id="srcline293">293</a></span><span class="line"><span class="comment">%peak, thus it is important to ordenate the values to be seek</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,294" id="srcline294">294</a></span><span class="line"><span class="comment">%from the lower part of the eye diagram to the uper part of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,295" id="srcline295">295</a></span><span class="line"><span class="comment">%eye diagram.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,296" id="srcline296">296</a></span><span class="line"><span class="comment">%                 ValToSeek = sort(ValToSeek,'ascend');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,297" id="srcline297">297</a></span><span class="line"><span class="comment">%                 OccuCount = zeros(1,size(EyeSymMat,1));                        %Auxiliar Variable for accounting.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,298" id="srcline298">298</a></span><span class="line"><span class="comment">%                 for kk=1:size(EyeSymMat,1)                                     %For every sample within a symbol period</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,299" id="srcline299">299</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,300" id="srcline300">300</a></span><span class="line"><span class="comment">%                     OccuCount(kk) = OccuCount(kk)+sum((EyeSymMat(kk,:)&gt;=min(<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,301" id="srcline301">301</a></span><span class="line"><span class="comment">%                         Esync))&amp;(EyeSymMat(kk,:)&lt;=UpeSymPer*EyeOpenLow)); %Account all occurencies of the value 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,302" id="srcline302">302</a></span><span class="line"><span class="comment">%                     OccuCount(kk) = OccuCount(kk)+sum((EyeSymMat(kk,:)&gt;=<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,303" id="srcline303">303</a></span><span class="line"><span class="comment">%                         LowSymPer*EyeOpenHigh)&amp;(EyeSymMat(kk,:)&lt;=max(Esync))); %Account all occurencies of the value 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,304" id="srcline304">304</a></span><span class="line"><span class="comment">%                 end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,305" id="srcline305">305</a></span><span class="line"><span class="comment">%The point of symmetry of the eye diagram will be where the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,306" id="srcline306">306</a></span><span class="line"><span class="comment">%maximum number of occurrences were measured inasmuch as those</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,307" id="srcline307">307</a></span><span class="line"><span class="comment">%are the points where all the bits go to the center of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,308" id="srcline308">308</a></span><span class="line"><span class="comment">%symbol.  From the maximum number of occurrences, it can happen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,309" id="srcline309">309</a></span><span class="line"><span class="comment">%for more than one sample within one symbol period, in the best</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,310" id="srcline310">310</a></span><span class="line"><span class="comment">%case, all samples would have the same accounting as it is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,311" id="srcline311">311</a></span><span class="line"><span class="comment">%shown the ilustration above hence the symmetry will be at the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,312" id="srcline312">312</a></span><span class="line"><span class="comment">%middle sample of this group of maximum occurrences. This value</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,313" id="srcline313">313</a></span><span class="line"><span class="comment">%can be found by the mean of the samples positions within the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,314" id="srcline314">314</a></span><span class="line"><span class="comment">%symbol period. The problem with this approach is that the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,315" id="srcline315">315</a></span><span class="line"><span class="comment">%signal must be synchronized with the maximum displacement of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,316" id="srcline316">316</a></span><span class="line"><span class="comment">%a symbol period minus 25% of the eye Longitudinal opening if</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,317" id="srcline317">317</a></span><span class="line"><span class="comment">%the displacement is higher than that the point of symmetry</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,318" id="srcline318">318</a></span><span class="line"><span class="comment">%will be wrongly measured.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,319" id="srcline319">319</a></span><span class="line"><span class="comment">%                 [SymLoc] = round(mean(find(ismember(OccuCount,max(OccuCount)<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,320" id="srcline320">320</a></span><span class="line"><span class="comment">%                     ))));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,321" id="srcline321">321</a></span><span class="line"><span class="comment">%             figure;findpeaks(OccuCount,'SortStr','descend');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,322" id="srcline322">322</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line"><span class="comment">%% Actualy Receiving Data:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line"><span class="mxinfo " id="T2:U325"><span class="var type1" id="S54T2U446">ThisDataSize</span> = <span class="mxinfo " id="T2:U327"><span class="mxinfo " id="T1:U328"><span class="var type1" id="S20T1U450">NPPB</span>/<span class="mxinfo " id="T1:U330">2</span></span>:<span class="var type1" id="S20T1U452">NPPB</span>:<span class="mxinfo " id="T1:U332">size(<span class="var type1" id="S5T2U455">Esync</span>,2)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line"><span class="comment">%ThisDataPos  = 1:NPPB:size(Esync,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line"><span class="mxinfo " id="T2:U334"><span class="var type1" id="S11T2U459">Data</span>  = <span class="mxinfo " id="T2:U336">zeros(<span class="mxinfo " id="T1:U337">1</span>,<span class="mxinfo " id="T1:U338">length(<span class="var type1" id="S54T2U465">ThisDataSize</span>)</span>)</span></span>;                                                  <span class="comment">%Initialization of the vector that will store the income data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line"><span class="mxinfo " id="T2:U340"><span class="var type1" id="S55T2U468">DataU</span> = <span class="mxinfo " id="T2:U342">zeros(<span class="mxinfo " id="T1:U343">1</span>,<span class="mxinfo " id="T1:U344">length(<span class="var type1" id="S54T2U474">ThisDataSize</span>)</span>)</span></span>;                                                  <span class="comment">%Initialization of the vector that will store the income data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line"><span class="comment">% DataS = zeros(1,length(ThisDataSize));                                                  %Initialization of the vector that will store the income data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,329" id="srcline329">329</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S48T1U477">kk</span>=<span class="mxinfo " id="T1:U347">1</span>:length(<span class="var type1" id="S54T2U482">ThisDataSize</span>)<span class="comment">%length(Esync(ThisDataSize))                                    %The comparison process will be made for each symbol period</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,330" id="srcline330">330</a></span><span class="line">    <span class="comment">%MeanOfData = mean(EoutI((kk-1)+SymLocI(1)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,331" id="srcline331">331</a></span><span class="line">    <span class="mxinfo " id="T1:U349"><span class="var type1" id="S56T1U485">MeanOfData</span> = <span class="mxinfo " id="T1:U351">mean(<span class="mxinfo " id="T1:U352"><span class="var type1" id="S5T2U489">Esync</span>(<span class="mxinfo " id="T1:U354"><span class="mxinfo " id="T1:U355">(<span class="mxinfo " id="T1:U356"><span class="var type1" id="S48T1U494">kk</span>-<span class="mxinfo " id="T1:U358">1</span></span>)*<span class="var type1" id="S20T1U496">NPPB</span></span>+<span class="mxinfo " id="T1:U360"><span class="var type1" id="S20T1U498">NPPB</span>/<span class="mxinfo " id="T1:U362">2</span></span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,332" id="srcline332">332</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T7:U363"><span class="var type1" id="S56T1U503">MeanOfData</span> &gt; <span class="var type1" id="S53T1U504">LevelDec3</span></span><span class="comment">%EyeOpenLowI+EyeOpenI/2                     %If it is the uper level the incoming data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,333" id="srcline333">333</a></span><span class="line">        <span class="mxinfo " id="T1:U366"><span class="mxinfo " id="T1:U367"><span class="var type1" id="S11T2U508">Data</span>(<span class="var type1" id="S48T1U509">kk</span>)</span> = <span class="mxinfo " id="T1:U370">1</span></span>;                                 <span class="comment">%is 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,334" id="srcline334">334</a></span><span class="line">    <span class="keyword">else</span>                                                       <span class="comment">%If it is the lowest level the incoming data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,335" id="srcline335">335</a></span><span class="line">        <span class="mxinfo " id="T1:U371"><span class="mxinfo " id="T1:U372"><span class="var type1" id="S11T2U515">Data</span>(<span class="var type1" id="S48T1U516">kk</span>)</span> = <span class="mxinfo " id="T1:U375">0</span></span>;                                 <span class="comment">%is 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,336" id="srcline336">336</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,337" id="srcline337">337</a></span><span class="line">    <span class="comment">%MeanOfData = mean(Esync((kk-1)*NPPB+(NPPB/2)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,338" id="srcline338">338</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T7:U376"><span class="var type1" id="S56T1U521">MeanOfData</span> &gt; <span class="var type1" id="S26T1U522">LevDefDpqsk</span></span><span class="comment">%EyeOpenLowI+EyeOpenI/2                     %If it is the uper level the incoming data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,339" id="srcline339">339</a></span><span class="line">        <span class="mxinfo " id="T1:U379"><span class="mxinfo " id="T1:U380"><span class="var type1" id="S55T2U526">DataU</span>(<span class="var type1" id="S48T1U527">kk</span>)</span> = <span class="mxinfo " id="T1:U383">1</span></span>;                                 <span class="comment">%is 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,340" id="srcline340">340</a></span><span class="line">    <span class="keyword">else</span>                                                       <span class="comment">%If it is the lowest level the incoming data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,341" id="srcline341">341</a></span><span class="line">        <span class="mxinfo " id="T1:U384"><span class="mxinfo " id="T1:U385"><span class="var type1" id="S55T2U533">DataU</span>(<span class="var type1" id="S48T1U534">kk</span>)</span> = <span class="mxinfo " id="T1:U388">0</span></span>;                                 <span class="comment">%is 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,342" id="srcline342">342</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,343" id="srcline343">343</a></span><span class="line"><span class="comment">%     if CalcS==1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,344" id="srcline344">344</a></span><span class="line"><span class="comment">%         %MeanOfData = mean(Esync((kk-1)*NPPB+(NPPB/2)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,345" id="srcline345">345</a></span><span class="line"><span class="comment">%         if MeanOfData &gt; EyeOpenLowI + EyeOpenI/2%EyeOpenLowI+EyeOpenI/2                     %If it is the uper level the incoming data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,346" id="srcline346">346</a></span><span class="line"><span class="comment">%             DataS(kk) = 1;                                 %is 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,347" id="srcline347">347</a></span><span class="line"><span class="comment">%         else                                                       %If it is the lowest level the incoming data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,348" id="srcline348">348</a></span><span class="line"><span class="comment">%             DataS(kk) = 0;                                 %is 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,349" id="srcline349">349</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,350" id="srcline350">350</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,351" id="srcline351">351</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,352" id="srcline352">352</a></span><span class="line"><span class="comment">%%       Calculating the Bit Error Ratio (BER)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,353" id="srcline353">353</a></span><span class="line"><span class="comment">%The final process here is to count the number of wrongdoings</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,354" id="srcline354">354</a></span><span class="line"><span class="comment">%of this whole process upon the transmited data for</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,355" id="srcline355">355</a></span><span class="line"><span class="comment">%quantitative analizes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,356" id="srcline356">356</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,357" id="srcline357">357</a></span><span class="line"><span class="mxinfo " id="T2:U389"><span class="var type1" id="S58T2U538">TxDataA</span> = <span class="mxinfo " id="T2:U391"><span class="var type1" id="S25T4U540">TxDataMat</span>(<span class="var type1" id="S24T1U541">ThisCarr</span>,<span class="mxinfo " id="T5:U394">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,358" id="srcline358">358</a></span><span class="line"><span class="mxinfo " id="T4:U395"><span class="var type1" id="S59T4U545">TxDataB</span> = <span class="mxinfo " id="T4:U397">reshape(<span class="var type1" id="S58T2U548">TxDataA</span>,<span class="var type1" id="S21T1U549">NbDPSK</span>,<span class="var type1" id="S22T1U550">CurTesSiz</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,359" id="srcline359">359</a></span><span class="line"><span class="mxinfo " id="T4:U401"><span class="var type1" id="S60T4U553">TxDataC</span> = <span class="mxinfo " id="T4:U403"><span class="var type1" id="S59T4U555">TxDataB</span>(<span class="mxinfo " id="T2:U405"><span class="mxinfo " id="T1:U406"><span class="mxinfo " id="T1:U407">1</span>+<span class="var type1" id="S23T1U559">SyncPeriod</span></span>:<span class="mxinfo " id="T1:U409"><span class="mxinfo " id="T1:U410">end</span>-<span class="var type1" id="S23T1U563">SyncPeriod</span></span></span>,<span class="mxinfo " id="T5:U412">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,360" id="srcline360">360</a></span><span class="line"><span class="mxinfo " id="T2:U413"><span class="var type1" id="S10T2U567">TxData</span>  = <span class="mxinfo " id="T2:U415">reshape(<span class="var type1" id="S60T4U570">TxDataC</span>,1,<span class="mxinfo " id="T1:U417"><span class="mxinfo " id="T1:U418">size(<span class="var type1" id="S60T4U575">TxDataC</span>,1)</span>*<span class="mxinfo " id="T1:U420">size(<span class="var type1" id="S60T4U579">TxDataC</span>,2)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,361" id="srcline361">361</a></span><span class="line"><span class="comment">% if CalcS</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,362" id="srcline362">362</a></span><span class="line"><span class="comment">%     %DataS = DataS(1+SyncPeriod:end-SyncPeriod);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,363" id="srcline363">363</a></span><span class="line"><span class="comment">%     BitErrS = sum(xor(TxData,DataS));%Comparison between the Transmited and received and counting the differences</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,364" id="srcline364">364</a></span><span class="line"><span class="comment">%     BerDPSKS = BitErrS/((NbDPSK-(2*SyncPeriod))*CurTesSiz);%Calculating the ration of wrong bits and the total number of bits transmited</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,365" id="srcline365">365</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,366" id="srcline366">366</a></span><span class="line"><span class="comment">%Data  = Data(1+SyncPeriod:end-SyncPeriod);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,367" id="srcline367">367</a></span><span class="line"><span class="comment">%DataM  = DataM(1+SyncPeriod:end-SyncPeriod);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,368" id="srcline368">368</a></span><span class="line"><span class="comment">%DataL  = DataL(1+SyncPeriod:end-SyncPeriod);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,369" id="srcline369">369</a></span><span class="line"><span class="comment">%DataU  = DataU(1+SyncPeriod:end-SyncPeriod);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,370" id="srcline370">370</a></span><span class="line"><span class="comment">%AberLevAuxI(4) = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,371" id="srcline371">371</a></span><span class="line"><span class="comment">%ValsLevAuxI(4) = 0.01;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,372" id="srcline372">372</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,373" id="srcline373">373</a></span><span class="line"><span class="mxinfo " id="T1:U422"><span class="var type1" id="S61T1U583">BitErr1</span>  = <span class="mxinfo " id="T1:U424">sum(<span class="mxinfo " id="T9:U425">xor(<span class="var type1" id="S10T2U588">TxData</span>,<span class="var type1" id="S11T2U589">Data</span>)</span>)</span></span>;                        <span class="comment">%Comparison between the Transmited and received and counting the differences</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,374" id="srcline374">374</a></span><span class="line"><span class="comment">%BitErr(2)  = sum(xor(TxData,DataM));                       %Comparison between the Transmited and received and counting the differences</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,375" id="srcline375">375</a></span><span class="line"><span class="comment">%BitErr(3)  = sum(xor(TxData,DataL));                       %Comparison between the Transmited and received and counting the differences</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,376" id="srcline376">376</a></span><span class="line"><span class="mxinfo " id="T1:U428"><span class="var type1" id="S64T1U592">BitErr4</span>  = <span class="mxinfo " id="T1:U430">sum(<span class="mxinfo " id="T9:U431">xor(<span class="var type1" id="S10T2U597">TxData</span>,<span class="var type1" id="S55T2U598">DataU</span>)</span>)</span></span>;                       <span class="comment">%Comparison between the Transmited and received and counting the differences</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,377" id="srcline377">377</a></span><span class="line"><span class="mxinfo " id="T1:U434"><span class="var type1" id="S2T1U601">BerDPSK</span> = <span class="mxinfo " id="T1:U436"><span class="var type1" id="S61T1U603">BitErr1</span>/(<span class="mxinfo " id="T1:U438">(<span class="mxinfo " id="T1:U439"><span class="var type1" id="S21T1U608">NbDPSK</span>-(<span class="mxinfo " id="T1:U441"><span class="mxinfo " id="T1:U442">2</span>*<span class="var type1" id="S23T1U612">SyncPeriod</span></span>)</span>)*<span class="var type1" id="S22T1U613">CurTesSiz</span></span>)</span></span>;<span class="comment">%Calculating the ration of wrong bits and the total number of bits transmited</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,378" id="srcline378">378</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U445"><span class="var type1" id="S64T1U617">BitErr4</span>&lt;<span class="var type1" id="S61T1U618">BitErr1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,379" id="srcline379">379</a></span><span class="line">    <span class="mxinfo " id="T1:U448"><span class="var type1" id="S2T1U621">BerDPSK</span> = <span class="mxinfo " id="T1:U450"><span class="var type1" id="S64T1U623">BitErr4</span>/(<span class="mxinfo " id="T1:U452">(<span class="mxinfo " id="T1:U453"><span class="var type1" id="S21T1U628">NbDPSK</span>-(<span class="mxinfo " id="T1:U455"><span class="mxinfo " id="T1:U456">2</span>*<span class="var type1" id="S23T1U632">SyncPeriod</span></span>)</span>)*<span class="var type1" id="S22T1U633">CurTesSiz</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,380" id="srcline380">380</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,381" id="srcline381">381</a></span><span class="line"><span class="comment">%end</span></span></span>
</pre>
